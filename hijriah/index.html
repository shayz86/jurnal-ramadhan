<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>Kalender Hijriah</title>
<link rel="stylesheet" href="hijriah.css"/>

</head>
<body>

<header class="top-bar">
  <button onclick="history.back()">‚Üê</button>
  <h1>Kalender Hijriah</h1>
  <button id="fastingBtn">üìÖ</button>
</header>

<section class="month-bar">
  <button onclick="changeMonth(-1)">‚Äπ</button>
  <h2 id="monthTitle"></h2>
  <button onclick="changeMonth(1)">‚Ä∫</button>
</section>

<div class="weekdays">
  <span>Sen</span>
  <span>Sel</span>
  <span>Rab</span>
  <span>Kam</span>
  <span>Jum</span>
  <span>Sab</span>
  <span>Min</span>
</div>

<div id="calendarGrid" class="calendar-grid"></div>

<script>

// ============================
// STATE
// ============================

let viewDate = new Date();

// Arabic digits
const arabicNums = ["Ÿ†","Ÿ°","Ÿ¢","Ÿ£","Ÿ§","Ÿ•","Ÿ¶","Ÿß","Ÿ®","Ÿ©"];

function toArabic(n){
 return n.toString().split("").map(d=>arabicNums[d]).join("");
}

// hijri formatter
const hijriFmt = new Intl.DateTimeFormat("ar-SA-u-ca-islamic-umalqura",{
 day:"numeric",
 month:"long",
 year:"numeric"
});

const hijriParts = d => hijriFmt.formatToParts(d);

// ============================
// TODAY HIJRI
// ============================

const today = new Date();
const todayParts = hijriParts(today);

const todayHDay = +todayParts.find(p=>p.type==="day").value;
const todayHMonth = todayParts.find(p=>p.type==="month").value;
const todayHYear = +todayParts.find(p=>p.type==="year").value;

// ============================
// RENDER
// ============================

function renderCalendar(){

 const grid = document.getElementById("calendarGrid");
 grid.innerHTML="";

 // title month
 const titleParts = hijriParts(viewDate);

 const monthName = titleParts.find(p=>p.type==="month").value;
 const yearNum = titleParts.find(p=>p.type==="year").value;

 document.getElementById("monthTitle").innerText =
   `${monthName} ${yearNum} H`;

 // start from first gregorian day of month
 const firstDay = new Date(viewDate.getFullYear(),viewDate.getMonth(),1);

 const firstHijriMonth =
  hijriParts(firstDay).find(p=>p.type==="month").value;

 const weekday = (firstDay.getDay()+6)%7;

 for(let i=0;i<weekday;i++)
   grid.appendChild(document.createElement("div"));

 for(let i=0;i<35;i++){

  const d = new Date(firstDay);
  d.setDate(d.getDate()+i);

  const parts = hijriParts(d);

  const hDay = +parts.find(p=>p.type==="day").value;
  const hMonth = parts.find(p=>p.type==="month").value;
  const hYear = +parts.find(p=>p.type==="year").value;

  if(hMonth!==firstHijriMonth) break;

  const cell=document.createElement("div");
  cell.className="day";

  cell.innerHTML=`
    <div class="g">${d.getDate()}</div>
    <div class="h">${toArabic(hDay)}</div>
  `;

  if(
    hDay===todayHDay &&
    hMonth===todayHMonth &&
    hYear===todayHYear
  ){
    cell.classList.add("today");
  }

  grid.appendChild(cell);
 }

}

function changeMonth(dir){
 viewDate.setMonth(viewDate.getMonth()+dir);
 renderCalendar();
}

renderCalendar();

</script>

</body>
</html>
