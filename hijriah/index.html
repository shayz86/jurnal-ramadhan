<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kalender Hijriah</title>

<link rel="stylesheet" href="hijriah.css" />
</head>
<body>

<header class="topbar">
  <button onclick="history.back()" class="back">‚Üê</button>
  <h1>Kalender Hijriah</h1>

  <button id="openPuasa" class="calendarBtn">üìÖ</button>
</header>

<section class="monthNav">
  <button id="prevMonth">‚Äπ</button>
  <h2 id="monthTitle">-</h2>
  <button id="nextMonth">‚Ä∫</button>
</section>

<div class="weekday">
  <span>Sen</span>
  <span>Sel</span>
  <span>Rab</span>
  <span>Kam</span>
  <span>Jum</span>
  <span>Sab</span>
  <span>Min</span>
</div>

<div id="calendarGrid" class="calendar-grid"></div>

<!-- ================= POPUP PUASA ================= -->

<div id="puasaPopup" class="popup">
 <div class="popupBox">
   <h3>Puasa Sunnah</h3>

   <ul>
     <li>‚úî Senin & Kamis</li>
     <li>‚úî Ayyamul Bidh (13-15)</li>
     <li>‚úî Puasa Daud</li>
     <li>‚úî Puasa Arafah</li>
     <li>‚úî Puasa Asyura</li>
   </ul>

   <button onclick="closePuasa()">Tutup</button>
 </div>
</div>

<script>
/* ================= ARABIC NUM ================= */

const arabNums=["Ÿ†","Ÿ°","Ÿ¢","Ÿ£","Ÿ§","Ÿ•","Ÿ¶","Ÿß","Ÿ®","Ÿ©"];

function toArabic(num){
 return num.toString().split("").map(n=>arabNums[n]).join("");
}

/* ================= MONTH NAMES ================= */

const hijriMonths=[
 "Muharram","Safar","Rabi'ul Awal","Rabi'ul Akhir",
 "Jumadal Ula","Jumadal Akhirah",
 "Rajab","Sha'ban","Ramadhan",
 "Syawal","Dzulqa'dah","Dzulhijjah"
];

const grid=document.getElementById("calendarGrid");
const monthTitle=document.getElementById("monthTitle");

/* ================= FORMATTER ================= */

const hijriFmt=new Intl.DateTimeFormat(
 "en-TN-u-ca-islamic",
 {day:"numeric",month:"numeric",year:"numeric"}
);

function getHijriParts(date){
 const parts=hijriFmt.formatToParts(date);
 const obj={};

 parts.forEach(p=>{
  if(p.type!=="literal") obj[p.type]=parseInt(p.value);
 });

 return obj;
}

/* ================= TODAY FIX ================= */

// simpan hari real SEKALI
const realToday=new Date();
const todayHijri=getHijriParts(realToday);

/* ================= VIEW DATE ================= */

let baseDate=new Date();

/* ================= DAYS IN MONTH ================= */

function getHijriMonthLength(date){

 const test=new Date(date);
 const start=getHijriParts(test).month;

 let count=0;

 while(true){
  const h=getHijriParts(test);
  if(h.month!==start) break;
  count++;
  test.setDate(test.getDate()+1);
 }

 return count;
}

/* ================= RENDER ================= */

function renderCalendar(){

 grid.innerHTML="";

 const hijri=getHijriParts(baseDate);

 const hMonth=hijri.month-1;
 const hYear=hijri.year;
 const hDay=hijri.day;

 monthTitle.textContent=
  hijriMonths[hMonth]+" "+hYear+" H";

 // cari awal bulan hijriah
 const firstDayDate=new Date(baseDate);
 firstDayDate.setDate(
  baseDate.getDate()-(hDay-1)
 );

 const startOffset=firstDayDate.getDay()===0
  ?6:firstDayDate.getDay()-1;

 for(let i=0;i<startOffset;i++){
  grid.appendChild(document.createElement("div"));
 }

 const daysInMonth=getHijriMonthLength(firstDayDate);

 for(let d=1;d<=daysInMonth;d++){

  const cell=document.createElement("div");
  cell.className="hijri-day";

  const g=document.createElement("div");
  g.className="greg";

  const mDate=new Date(firstDayDate);
  mDate.setDate(firstDayDate.getDate()+d-1);

  g.textContent=mDate.getDate();

  const h=document.createElement("div");
  h.className="hijri";
  h.textContent=toArabic(d);

  // ===== highlight ONLY real today =====
  if(
    d===todayHijri.day &&
    hijri.month===todayHijri.month &&
    hijri.year===todayHijri.year
  ){
    cell.classList.add("today");
  }

  cell.append(g,h);
  grid.appendChild(cell);
 }
}

renderCalendar();

/* ================= NAV ================= */

document.getElementById("prevMonth").onclick=()=>{
 baseDate.setDate(baseDate.getDate()-30);
 renderCalendar();
};

document.getElementById("nextMonth").onclick=()=>{
 baseDate.setDate(baseDate.getDate()+30);
 renderCalendar();
};

/* ================= POPUP ================= */

const popup=document.getElementById("puasaPopup");

document.getElementById("openPuasa").onclick=()=>{
 popup.classList.add("show");
};

function closePuasa(){
 popup.classList.remove("show");
}
</script>

</body>
</html>
