<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kalender Hijriah</title>

<link rel="stylesheet" href="hijriah.css"/>

</head>
<body>

<header class="top-bar">
  <button onclick="history.back()">‚Üê</button>
  <h1>Kalender Hijriah</h1>
  <button id="fastingBtn">üìÖ</button>
</header>

<section class="month-bar">
  <button onclick="changeMonth(-1)">‚Äπ</button>
  <h2 id="monthTitle"></h2>
  <button onclick="changeMonth(1)">‚Ä∫</button>
</section>

<div class="weekdays">
  <span>Sen</span>
  <span>Sel</span>
  <span>Rab</span>
  <span>Kam</span>
  <span>Jum</span>
  <span>Sab</span>
  <span>Min</span>
</div>

<div id="calendarGrid" class="calendar-grid"></div>

<script>

// ============================
// GLOBAL STATE
// ============================

let viewDate = new Date();

const arabicNums = ["Ÿ†","Ÿ°","Ÿ¢","Ÿ£","Ÿ§","Ÿ•","Ÿ¶","Ÿß","Ÿ®","Ÿ©"];

function toArabic(num) {
 return num.toString().split("").map(n=>arabicNums[n]).join("");
}

// ============================
// TODAY HIJRI
// ============================

const today = new Date();
const todayHijri = new Intl.DateTimeFormat("en-TN-u-ca-islamic", {
 day:"numeric",
 month:"numeric",
 year:"numeric"
}).format(today).split("/").map(Number);

const [todayHDay, todayHMonth, todayHYear] = todayHijri;

// ============================
// RENDER
// ============================

function renderCalendar() {

 const grid = document.getElementById("calendarGrid");
 grid.innerHTML = "";

 // hijri for first of month
 const firstHijri = new Intl.DateTimeFormat("en-TN-u-ca-islamic", {
  day:"numeric",
  month:"long",
  year:"numeric"
 }).format(viewDate);

 document.getElementById("monthTitle").innerText = firstHijri;

 // first day index
 const firstDay = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1);

 const hijriMonth = new Intl.DateTimeFormat("en-TN-u-ca-islamic", {
  month:"numeric"
 }).format(firstDay);

 const hijriYear = new Intl.DateTimeFormat("en-TN-u-ca-islamic", {
  year:"numeric"
 }).format(firstDay);

 const weekday = (firstDay.getDay()+6)%7;

 for(let i=0;i<weekday;i++){
  grid.appendChild(document.createElement("div"));
 }

 for(let i=0;i<30;i++){

  const cell = document.createElement("div");
  cell.className="day";

  const temp = new Date(firstDay);
  temp.setDate(temp.getDate()+i);

  const hijriParts = new Intl.DateTimeFormat("en-TN-u-ca-islamic",{
   day:"numeric",
   month:"numeric",
   year:"numeric"
  }).format(temp).split("/").map(Number);

  const [hDay,hMonth,hYear] = hijriParts;

  // STOP jika bulan berganti
  if(hMonth!=hijriMonth) break;

  const gDay = temp.getDate();

  cell.innerHTML=`
    <div class="g">${gDay}</div>
    <div class="h">${toArabic(hDay)}</div>
  `;

  // today highlight
  if(
   hDay===todayHDay &&
   hMonth===todayHMonth &&
   hYear===todayHYear
  ){
   cell.classList.add("today");
  }

  grid.appendChild(cell);
 }

}

function changeMonth(dir){
 viewDate.setMonth(viewDate.getMonth()+dir);
 renderCalendar();
}

renderCalendar();

</script>

</body>
</html>
