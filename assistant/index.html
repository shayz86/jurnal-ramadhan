<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Smart Islamic Assistant â€” NoorRahma</title>

<meta name="theme-color" content="#047857"/>

<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config={
 darkMode:"class",
 theme:{extend:{
  colors:{ slate:{850:"#1e293b",950:"#020617"} }
 }}
}
</script>

<style>
body{font-family:system-ui}
.hidden{display:none}
</style>
</head>

<body class="bg-slate-50 dark:bg-slate-950 text-slate-800 dark:text-slate-100">

<!-- ================= PRO BLOCK ================= -->

<div id="blocked" class="hidden min-h-screen flex items-center justify-center p-6">
 <div class="bg-white dark:bg-slate-900 rounded-3xl p-8 max-w-sm text-center shadow-xl">
  <div class="text-5xl mb-4">ğŸ”’</div>
  <h2 class="font-bold text-lg mb-2">Fitur PRO</h2>
  <p class="text-sm text-slate-500 mb-6">
   Smart Islamic Assistant hanya tersedia untuk akun PRO.
  </p>

  <button onclick="location.href='/'"
   class="bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold w-full">
   Kembali ke Home
  </button>
 </div>
</div>

<!-- ================= CHAT UI ================= -->

<div id="chat" class="hidden flex flex-col min-h-screen">

<header class="bg-emerald-700 text-white p-4 flex items-center justify-between shadow-md">
 <div class="flex items-center gap-3">
  <button onclick="history.back()">â†</button>
  <h1 class="font-bold">Smart Islamic Assistant</h1>
 </div>

 <button onclick="clearChat()" class="text-xs opacity-80">
  ğŸ—‘ Reset
 </button>
</header>

<main id="messages" class="flex-1 p-4 space-y-4 overflow-y-auto"></main>

<!-- chips -->
<div class="px-4 pb-2 flex gap-2 overflow-x-auto text-xs">
 <button class="chip">ğŸ•Œ Waktu shalat</button>
 <button class="chip">ğŸ“– Tafsir ayat</button>
 <button class="chip">ğŸŒ™ Puasa sunnah</button>
 <button class="chip">ğŸ¤² Doa harian</button>
</div>

<footer class="p-3 border-t dark:border-slate-800 flex gap-2">
 <input id="input"
  placeholder="Tanya seputar ibadah..."
  class="flex-1 bg-slate-100 dark:bg-slate-800 rounded-xl px-4 py-3 text-sm focus:outline-emerald-500"/>

 <button onclick="sendMsg()"
  class="bg-emerald-600 text-white px-4 py-3 rounded-xl font-bold">
  Kirim
 </button>
</footer>

</div>

<script>
/* ================= PRO GUARD ================= */

const isPro=localStorage.getItem("nr_is_pro")==="1";
const blocked=document.getElementById("blocked");
const chat=document.getElementById("chat");

if(!isPro){
 blocked.classList.remove("hidden");
}else{
 chat.classList.remove("hidden");
}

/* ================= STATE ================= */

let history=JSON.parse(localStorage.getItem("nr_assistant_history")||"[]");

const messages=document.getElementById("messages");
const input=document.getElementById("input");

/* ================= UI ================= */

function renderBubble(text,from="bot",save=true){
 const wrap=document.createElement("div");

 wrap.className=
  from==="user"
   ?"bg-emerald-600 text-white ml-auto max-w-[80%] p-3 rounded-2xl"
   :"bg-white dark:bg-slate-900 mr-auto max-w-[80%] p-3 rounded-2xl shadow";

 wrap.innerHTML=`
  <div>${text}</div>
  <div class="text-[9px] opacity-50 mt-1">${new Date().toLocaleTimeString()}</div>
 `;

 messages.appendChild(wrap);
 messages.scrollTop=messages.scrollHeight;

 if(save){
  history.push({from,text,time:Date.now()});
  localStorage.setItem("nr_assistant_history",JSON.stringify(history));
 }
}

/* ================= LOAD HISTORY ================= */

function loadHistory(){
 if(history.length){
  history.forEach(m=>renderBubble(m.text,m.from,false));
 }else{
  renderBubble(
   "Assalamuâ€™alaikum ğŸ˜Š Saya Smart Islamic Assistant. Silakan tanya seputar ibadah, Qurâ€™an, puasa, atau zakat."
  );
 }
}

loadHistory();

/* ================= SEND ================= */

function sendMsg(){
 const q=input.value.trim();
 if(!q)return;

 renderBubble(q,"user");
 input.value="";

 showTyping();

 sendToAI(q);
}

/* ================= TYPING ================= */

let typingBubble=null;

function showTyping(){
 typingBubble=document.createElement("div");
 typingBubble.className="italic opacity-60";
 typingBubble.innerText="Mengetik...";
 messages.appendChild(typingBubble);
 messages.scrollTop=messages.scrollHeight;
}

function hideTyping(){
 if(typingBubble) typingBubble.remove();
}

/* ================= AI PLACEHOLDER ================= */

function sendToAI(text){

 // nanti ganti fetch API di sini ğŸ‘‡

 setTimeout(()=>{
  hideTyping();

  renderBubble(
   "ğŸ¤– Jawaban AI akan muncul di sini ketika backend siap. Saat ini UI & history sudah aktif."
  );

 },1000);

}

/* ================= CLEAR ================= */

function clearChat(){
 if(confirm("Hapus semua percakapan?")){
  history=[];
  localStorage.removeItem("nr_assistant_history");
  messages.innerHTML="";
  loadHistory();
 }
}

/* ================= CHIPS ================= */

document.querySelectorAll(".chip").forEach(c=>{
 c.className+=" bg-slate-200 dark:bg-slate-800 px-3 py-1 rounded-full whitespace-nowrap";
 c.onclick=()=>{
  input.value=c.innerText;
  input.focus();
 };
});
</script>

</body>
</html>
